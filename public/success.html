<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmed - Sote Beauty Shop</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-wrapper">
        <header class="main-header">
            <div class="header-container">
                <div class="logo">
                    <h1>Sote</h1>
                    <span class="tagline">Beauty Shop</span>
                </div>
                <nav class="main-nav">
                    <a href="/" class="nav-link">Shop</a>
                    <a href="/admin" class="nav-link">Dashboard</a>
                    <a href="/withdrawal" class="nav-link">Withdrawal</a>
                </nav>
            </div>
        </header>

        <main class="main-content">
            <div class="success-container">
                <div class="success-icon">✓</div>
                <h2>Order Confirmed!</h2>
                <p style="color: var(--text-secondary); margin-top: 1rem;">Thank you for your purchase. Your order is being processed.</p>
                
                <div class="success-details">
                    <div id="transactionDetails" class="transaction-details" style="display: none;">
                        <h3>Order Details</h3>
                        <div id="detailsContent"></div>
                    </div>
                </div>

                <div class="success-actions">
                    <a href="/" class="btn btn-secondary">Continue Shopping</a>
                    <a href="/admin" class="btn btn-primary">View Dashboard</a>
                </div>
            </div>
        </main>

        <footer class="main-footer">
            <p>© 2025 Sote Beauty Shop. Sandbox Mode - Test Environment</p>
        </footer>
    </div>

    <script src="app.js"></script>
    <script>
        // Extract transaction details from URL parameters if available
        const urlParams = new URLSearchParams(window.location.search);
        const transactionId = urlParams.get('transactionId');
        const externalId = urlParams.get('externalId');
        const amount = urlParams.get('amount');
        const email = sessionStorage.getItem('lastPaymentEmail') || 'customer@example.com';

        // Update transaction status to success in admin dashboard
        // Even if no transaction ID in URL, mark any pending transactions as success for demo
        try {
            const transactions = JSON.parse(localStorage.getItem('fakeTransactions') || '[]');
            
            if (externalId || transactionId) {
                const txnId = externalId || transactionId;
                const transaction = transactions.find(t => t.id === txnId);
                
                if (transaction) {
                    transaction.status = 'success';
                    transaction.date = new Date().toLocaleString();
                    // Try to get phone from URL if available
                    const phone = urlParams.get('phone');
                    if (phone) transaction.phone = phone;
                } else {
                    // Create new successful transaction
                    transactions.unshift({
                        id: txnId,
                        date: new Date().toLocaleString(),
                        customerEmail: email,
                        phone: urlParams.get('phone') || '677123456',
                        product: sessionStorage.getItem('productName') || 'Product',
                        amount: amount ? parseFloat(amount) : 0,
                        status: 'success'
                    });
                }
            } else {
                // If no transaction ID, update the most recent pending transaction
                const pendingTxnId = sessionStorage.getItem('pendingTransactionId');
                if (pendingTxnId) {
                    const pendingTxn = transactions.find(t => t.id === pendingTxnId);
                    if (pendingTxn) {
                        pendingTxn.status = 'success';
                        pendingTxn.date = new Date().toLocaleString();
                        const phone = urlParams.get('phone');
                        if (phone) pendingTxn.phone = phone;
                    }
                } else {
                    // Fallback: update most recent pending transaction
                    const pendingTxn = transactions.find(t => t.status === 'pending');
                    if (pendingTxn) {
                        pendingTxn.status = 'success';
                        pendingTxn.date = new Date().toLocaleString();
                        const phone = urlParams.get('phone');
                        if (phone) pendingTxn.phone = phone;
                    }
                }
            }
            
            localStorage.setItem('fakeTransactions', JSON.stringify(transactions));
        } catch (e) {
            console.log('Could not update transaction status:', e);
        }

        if (transactionId || externalId) {
            document.getElementById('transactionDetails').style.display = 'block';
            const detailsContent = document.getElementById('detailsContent');
            
            let detailsHTML = '<div class="detail-row"><strong>Transaction ID:</strong> ' + (transactionId || externalId) + '</div>';
            if (amount) {
                detailsHTML += '<div class="detail-row"><strong>Amount:</strong> ' + amount + ' XAF</div>';
            }
            if (externalId) {
                detailsHTML += '<div class="detail-row"><strong>External ID:</strong> ' + externalId + '</div>';
            }
            
            detailsContent.innerHTML = detailsHTML;
        }
    </script>
</body>
</html>

